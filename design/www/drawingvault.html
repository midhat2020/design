{% extends "templates/web.html" %}

{% block title %} Dynamic Table Page {% endblock %}

{% block page_content %}
    <div class="main-div">
        <table id='drawing-table'>
            <thead>
                <tr>
                    <th style="width: 200px;">Name</th>
                    <th style="width: 200px;">Item</th>
                    <th style="width: 150px;">File</th>
                    <th style="width: 150px;">View</th>
                </tr>
            </thead>
            <tbody id="drawing-list"> 
                <!-- Table rows will be dynamically added here -->
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="4">0 of 0</td>
                </tr>
            </tfoot>
        </table>
        <div style="text-align: center;">
            <button id="load-more">Load More</button>
        </div>
    </div>
{% endblock %}

{% block style %}
    <style>
        .main-div {
            width: auto;
            margin: auto;
        }
        table {
            margin-bottom: 20px;
            border-collapse: collapse;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        th, td {
            border: 1px solid #e0e0e0;
            text-align: left;
            padding: 12px;
        }
        th {
            background-color: #f5f5f5;
        }
        tfoot {
            background-color: #f5f5f5;
        }
        #load-more {
            background-color: #fff;
            color: #333;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        #load-more:hover {
            background-color: #333;
            color: #fff;
        }
    </style>
{% endblock %}

{% block script %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
        // Your JSON data
        var jsonData = {{ permitted_drawings }}

        // Function to create a table row
        function createTableRow(item) {
            var row = document.createElement('tr');
            let query = Object.values(item)[0];
            Object.values(item).forEach(function(value, index) {
            var td = document.createElement('td');
            //console.log(query) issue
            // Check if the current value is for the 'File' column
            if (index === 2) { // Assuming 'File' is the second column
                var a = document.createElement('a');
                a.setAttribute('href', '/enggdesign?query=' + encodeURIComponent(query));
                a.textContent = 'View'; // Text displayed for the link
                td.appendChild(a);
            } else {
                td.textContent = value !== null ? value : 'N/A';
            }

            row.appendChild(td);
            });
            return row;
        }

        // Function to render JSON data to HTML table
        function renderTable(data) {
            var tableContainer = document.getElementById('drawing-list');
            var loadMoreBtn = document.getElementById('load-more');
            var currentIndex = 10;

            // Render initial rows
            for (var i = 0; i < Math.min(10, data.length); i++) {
            var item = data[i];
            tableContainer.appendChild(createTableRow(item));
            }

            // Show or hide the load more button based on the data length
            loadMoreBtn.style.display = data.length > 10 ? 'block' : 'none';

            // Update the number of rows displayed in the footer
            var footer = document.querySelector("tfoot td");
            footer.textContent = Math.min(10, data.length) + " of " + data.length;

            // Load more functionality
            loadMoreBtn.addEventListener('click', function() {
            for (var i = currentIndex; i < data.length && i < currentIndex + 10; i++) {
                var item = data[i];
                tableContainer.appendChild(createTableRow(item));
            }
            currentIndex += 10;

            // Show or hide the load more button based on the data length
            loadMoreBtn.style.display = currentIndex >= data.length ? 'none' : 'block';

            // Update the number of rows displayed in the footer
            var updatedRows = tableContainer.querySelectorAll("tr").length;
            footer.textContent = updatedRows + " of " + data.length;
            });
        }

        // Call the function with your JSON data
        renderTable(jsonData);
    });
</script>
{% endblock %}
